
%---- PACKAGES
\usepackage{ifdraft}

\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathrsfs}
\usepackage[hidelinks]{hyperref}
\usepackage[plain]{fancyref}
\usepackage{subcaption}
\let\labelindent\relax
\usepackage[inline]{enumitem}
\usepackage[table,xcdraw]{xcolor}
\usepackage{tikz}
\usepackage{booktabs}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{xspace}
\usepackage[final]{listings}
\usepackage{acronym}
\usepackage{url}
%\usepackage[square,sort,comma,numbers]{natbib}
\usepackage{etoolbox}
\patchcmd{\thebibliography}{\chapter*}{\section*}{}{}

\usepackage{etoolbox}
\makeatletter
\patchcmd{\@makecaption}
  {\scshape}
  {}
  {}
  {}
\patchcmd{\@makecaption}
  {\\}
  {.\ }
  {}
  {}


\let\refsection\relax
\usepackage[backend=bibtex,
   style=trad-abbrv,
%   maxcitenames=1,
   firstinits=true,
   hyperref=true,
   natbib=true,
   url=true,
   doi=false,
   defernumbers]{biblatex}
%
%
%----[ Biber ]----
\addbibresource[datatype=bibtex]{local.bib}
\addbibresource[datatype=bibtex]{bib/general.bib}
\addbibresource[datatype=bibtex]{bib/compsci.bib}
%\addbibresource[datatype=bibtex]{bib/learning.bib}
%\nocite{*}
%
%\newbibmacro{name:newformat}{%
%    \printnames{authors}
%%   \textbf{\namepartfamily}  % #1->\namepartfamily, #2->\namepartfamilyi
%%   \textbf{\namepartgiven}   % #3->\namepartgiven,  #4->\namepartgiveni
%%   [prefix: \namepartprefix] % #5->\namepartprefix, #6->\namepartprefixi
%%   [suffix: \namepartsuffix] % #7->\namepartsuffix, #8->\namepartsuffixi
%}
%
%\DeclareNameFormat{newformat}{%
%  \usebibmacro{name:newformat}{\textbf{#1}}{\textbf{#3}}{#5}{#7}%
%  \usebibmacro{name:andothers}%
%%  \nameparts{#1}% split the name data, will not be necessary in future versions
%%  \usebibmacro{name:newformat}%
%%  \usebibmacro{name:andothers}%
%}
%
\AtEveryBibitem
{
%   \clearlist{address}
%   \clearfield{date}
%   \clearfield{doi}
%   \clearfield{eprint}
%   \clearfield{isbn}
%   \clearfield{issn}
%   \clearfield{month}
%   \clearfield{note}
%   \clearfield{pages}
%   \clearlist{location}
   \clearfield{series}
%   \clearfield{url}
%   \clearname{editor}
%   \ifentrytype{inproceedings}
%     {\clearfield{day}
%      \clearfield{month}
%      \clearfield{volume}}{}
}
%
%\DeclareFieldFormat*{title}{\textsl{#1}\isdot}
%\DeclareFieldFormat*{journaltitle}{#1}
%\DeclareFieldFormat*{booktitle}{#1}
%
%\renewbibmacro{in:}{} % supress 'In: ' form
%
\DeclareSourcemap
 {\maps[datatype=bibtex,overwrite]
   {% Tag entries (through keywords)
    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Pp]roceedings}, replace={Proc.}]}
%        \map
      {\step[fieldsource=booktitle,
       match=\regexp{[Ii]nternational\s+[Cc]onference}, replace={Intl. Conf.}]}
%    \map
%      {\step[fieldsource=journal,
%       match=\regexp{[Jj]ournal}, replace={Jour.}]}
%    \map
%      {\step[fieldsource=journal,
%       match=\regexp{[Tt]ransactions}, replace={Trans.}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Pp]roceedings\s+of\s+the.+[Ee]uropean\s+[Cc]onference\s+in}, replace={European Conf. in}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{In\s+[Pp]roceedings\s+of\s+the.+[Ss]ymposium\s+on}, replace={Symp. on}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Pp]roceedings\s+of\s+the.+[Ii]nternational\s+[Cc]onference\s+on}, replace={Intl. Conf. on}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Pp]roceedings\s+of\s+the.+[Ii]nternational\s+[Ww]orkshop\s+on}, replace={Intl. Workshop on}]}
}}
%

\renewcommand\UrlFont{\color{blue}\rmfamily}
 
%color
\definecolor{OliveGreen}{rgb}{0,0.6,0.3}

%References
%% Listings
\def\fref{\Fref} % treat all \frefs as \Frefs
\renewcommand{\lstlistingname}{Algorithm}
\newcommand*{\fancyreflstlabelprefix}{lst}
\newcommand*{\Freflstname}{\lstlistingname}
\newcommand*{\freflstname}{\MakeLowercase{\lstlistingname}}
\Frefformat{plain}{\fancyreflstlabelprefix}%
  {\Freflstname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyreflstlabelprefix}%
  {\freflstname\fancyrefdefaultspacing#1}
\Frefformat{vario}{\fancyreflstlabelprefix}%
  {\Freflstname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyreflstlabelprefix}%
  {\freflstname\fancyrefdefaultspacing#1#3}

  
% ln delimiter
\newcommand*{\fancyreflnlabelprefix}{ln}
\newcommand*{\Freflnname}{Line}
\newcommand*{\freflnname}{\MakeLowercase{\Freflnname}}
\Frefformat{vario}{\fancyreflnlabelprefix}%
  {\Freflnname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyreflnlabelprefix}%
  {\freflnname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyreflnlabelprefix}%
  {\Freflnname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyreflnlabelprefix}%
  {\freflnname\fancyrefdefaultspacing#1}    

%def delimiter
\newcommand*{\fancyrefdeflabelprefix}{def}
\newcommand*{\Frefdefname}{Definition}
\newcommand*{\frefdefname}{\MakeLowercase{\Frefdefname}}
\Frefformat{vario}{\fancyrefdeflabelprefix}%
  {\Frefdefname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyrefdeflabelprefix}%
  {\frefdefname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyrefdeflabelprefix}%
  {\Frefdefname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyrefdeflabelprefix}%
  {\frefdefname\fancyrefdefaultspacing#1}    
  
%theorem delimiter
\newcommand*{\fancyreftheolabelprefix}{theo}
\newcommand*{\Freftheoname}{Theorem}
\newcommand*{\freftheoname}{\MakeLowercase{\Freftheoname}}
\Frefformat{vario}{\fancyreftheolabelprefix}%
  {\Freftheoname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyreftheolabelprefix}%
  {\freftheoname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyreftheolabelprefix}%
  {\Freftheoname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyreftheolabelprefix}%
  {\freftheoname\fancyrefdefaultspacing#1}    

%Proposition delimiter
\newcommand*{\fancyrefproplabelprefix}{prop}
\newcommand*{\Frefpropname}{Proposition}
\newcommand*{\frefpropname}{\MakeLowercase{\Frefpropname}}
\Frefformat{vario}{\fancyrefproplabelprefix}%
  {\Frefpropname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyrefproplabelprefix}%
  {\frefpropname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyrefproplabelprefix}%
  {\Frefpropname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyrefproplabelprefix}%
  {\frefpropname\fancyrefdefaultspacing#1}    
  
\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}
%Define Colors
\definecolor{gray}{RGB}{102,102,102}		%#666666
\definecolor{lightblue}{RGB}{0,102,153}		%#006699
\definecolor{lightgreen}{RGB}{102,153,0}	%#669900
\definecolor{bluegreen}{RGB}{51,153,126}	%#33997e
\definecolor{magenta}{RGB}{217,74,122}		%#d94a7a
\definecolor{orange}{RGB}{226,102,26}		%#e2661a
\definecolor{purple}{RGB}{125,71,147}		%#7d4793
\definecolor{green}{RGB}{113,138,98}		%#718a62
  
%Athena definition
\lstdefinestyle{floating}
 {frame=none,
  float=hpt,
  captionpos=b,
  aboveskip=-0.5pt,
  belowskip=-4pt,
  abovecaptionskip=1pt}

\lstdefinelanguage{Athena}{
  morekeywords = {module,domain,domains,declare,define,forall,exists,apply-method,conclude,assume,suppose-absurd,pick-any,with-witness,pick-witness,for,by-induction,datatype,datatypes,datatype-cases,structure,check,match,let,letrec,try,assert,lambda,method},
  comment = [l]{\#},
  sensitive = true,
  keywordstyle = \color{blue}\bfseries,
  ndkeywordstyle=\bfseries,
  commentstyle = \color{gray},
  numbers=left,
}

\lstdefinestyle{Athena}
 {language=Athena,
  numberbychapter=false,
  breaklines=true
  showstringspaces=false,
  basicstyle=\scriptsize\ttfamily,
  stepnumber=1,
  numbersep=3pt,
  showstringspaces=false,
  breaklines=true,
  stringstyle=\color{blue}\ttfamily,
  commentstyle=\scriptsize\color{delim}\ttfamily,
  numberstyle=\scriptsize\color{gray},
  tabsize=2, 
  style=floating,
  escapechar=`
}
 
\lstnewenvironment{athena}[1][]
 {\lstset{style=Athena,#1}}{}  

 
% athena in line source-code
\newcommand{\scode}[1]{\textrm{\texttt{#1}}}
\def\scode{\lstinline[style=Athena, basicstyle=\small\ttfamily,]}

%----[ Figures ]---
%\addtolength{\intextsep}{-1mm}

%%captions
%\addtolength{\abovecaptionskip}{-0mm}
%\addtolength{\belowcaptionskip}{-0mm}
%\captionsetup[figure]{aboveskip=-0ex,belowskip-0ex}
%\captionsetup[table]{aboveskip=-0ex,belowskip-3ex}
%\captionsetup[lstlisting]{aboveskip=-1ex,belowskip=-1ex}

%DPN
%\usepackage[version=0.96]{pgf}
%\usetikzlibrary{arrows, shapes, backgrounds}
%\usetikzlibrary{decorations.pathreplacing}
%\usetikzlibrary{shapes.misc}
%\usetikzlibrary{petri}

%% Petri nets
\tikzstyle{place}=[circle,thick,draw=black!75,minimum size=5mm]
\tikzstyle{iplace}=[circle,dashed,thick,draw=black!75,minimum size=5mm]
\tikzstyle{itransition}=[rectangle,draw,thick,fill=black,minimum size=1mm]
\tikzstyle{etransition}=[rectangle,draw,thick,minimum size=1mm]
\tikzstyle{ctransition}=[rectangle,draw,color=black!45,thick,fill=black!45,minimum size=1mm]


%----[ Commands ]---
%Latins
\newcommand{\eg}{\emph{e.g.,}\xspace}
\newcommand{\ie}{\emph{i.e.,}\xspace}
\newcommand{\cf}{\emph{cf.}\xspace}

\newcommand{\artlang}{SCuLPT\xspace}

%comments
% xcolor
\definecolor{author}{rgb}{.5, .5, .5}
\definecolor{comment}{rgb}{.1, .0, .9}
\definecolor{note}{rgb}{.9, .4, .0}
\definecolor{idea}{rgb}{.1, .7, .0}
\definecolor{missing}{rgb}{.9, .1, .0}


\newcommand{\authorcomment}[3][comment]
  {\ifdraft{\noindent
      \fbox{\footnotesize\textcolor{author}{\textsc{#2}}}
      \textcolor{#1}{\textsl{#3}}}{}}

\input{acronyms}

%Space squeezing
\let\orig@figure\figure
\renewcommand*{\figure}[1][]{\orig@figure[#1]\vspace{-0ex}} % before
\let\orig@endfigure\endfigure
\renewcommand*{\endfigure}{\vspace{-0ex}\orig@endfigure} % after

% Squeeze captions
\usepackage{caption}
\captionsetup[figure]{aboveskip=-0.1em,belowskip=-0.2em}
\captionsetup[table]{aboveskip=0em,belowskip=-0.5em}

\makeatother